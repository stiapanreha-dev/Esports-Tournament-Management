{% extends "base.html" %}

{% block title %}{{ user.username }} - Profile{% endblock %}

{% block content %}
<div class="mb-8">
    <div class="flex items-center justify-between">
        <h1 class="text-4xl font-bold">{{ user.username }}</h1>
        {% if is_own %}
            <a href="{{ url_for('edit_profile') }}" class="px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white font-bold rounded-lg transition">
                <i class="fas fa-edit mr-2"></i> Edit Profile
            </a>
        {% endif %}
    </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="lg:col-span-2">
        <!-- Player Info -->
        <div class="card p-6 mb-6">
            <h2 class="text-2xl font-bold mb-4"><i class="fas fa-user text-purple-400 mr-2"></i> Player Information</h2>

            <div class="grid grid-cols-2 gap-4 mb-6">
                <div>
                    <div class="text-gray-400 text-sm mb-1">Username</div>
                    <div class="text-lg font-bold">{{ user.username }}</div>
                </div>
                <div>
                    <div class="text-gray-400 text-sm mb-1">In-Game Name</div>
                    <div class="text-lg font-bold">{{ user.ign or '—' }}</div>
                </div>
                <div>
                    <div class="text-gray-400 text-sm mb-1">Full Name</div>
                    <div class="text-lg font-bold">{{ user.full_name or '—' }}</div>
                </div>
                <div>
                    <div class="text-gray-400 text-sm mb-1">Role</div>
                    <div class="text-lg font-bold">{{ user.role|title }}</div>
                </div>
            </div>

            {% if user.bio %}
                <div>
                    <div class="text-gray-400 text-sm mb-1">Bio</div>
                    <p class="text-gray-300">{{ user.bio }}</p>
                </div>
            {% endif %}
        </div>

        <!-- FACEIT -->
        {% if faceit %}
        <div class="card p-6 mb-6">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-2xl font-bold">
                    <img src="https://cdn-frontend.faceit-cdn.net/web/static/media/faceit-short-white.b43cf8fd.svg" alt="FACEIT" class="inline h-6 mr-2">
                    FACEIT
                </h2>
                {% if faceit.faceit_url %}
                    <a href="{{ faceit.faceit_url }}" target="_blank" class="text-orange-400 hover:text-orange-300 font-bold">
                        {{ faceit.nickname }} <i class="fas fa-external-link-alt text-xs ml-1"></i>
                    </a>
                {% endif %}
            </div>

            {% for game in faceit.games %}
            <div class="{% if not loop.first %}mt-3{% endif %} bg-gray-700 rounded-lg p-4">
                <div class="flex items-center justify-between flex-wrap gap-3">
                    <div class="text-lg font-bold text-white">{{ game.name }}</div>
                    <div class="flex items-center gap-6">
                        <div class="text-center">
                            <div class="text-gray-400 text-xs uppercase">ELO</div>
                            <div class="text-xl font-bold text-white">{{ game.elo }}</div>
                        </div>
                        <div class="text-center">
                            <div class="text-gray-400 text-xs uppercase">Level</div>
                            <div class="flex items-center gap-1">
                                <img src="https://cdn-frontend.faceit-cdn.net/web/static/media/assets_images_skill-icons_skill_level_{{ game.level }}_svg.svg"
                                     alt="Level {{ game.level }}" class="h-8 w-8"
                                     onerror="this.style.display='none'">
                                <span class="text-xl font-bold text-orange-400">{{ game.level }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Connected Accounts -->
        {% if user.steam_id %}
        <div class="card p-6 mb-6">
            <h2 class="text-2xl font-bold mb-4"><i class="fas fa-link text-purple-400 mr-2"></i> Connected Accounts</h2>
            <div class="flex flex-wrap gap-3">
                <a href="https://steamcommunity.com/profiles/{{ user.steam_id }}" target="_blank"
                   class="flex items-center gap-2 bg-[#171a21] hover:bg-[#2a475e] text-white px-4 py-2 rounded-lg transition">
                    <i class="fab fa-steam text-lg"></i> Steam Profile
                </a>
                {% if faceit and faceit.faceit_url %}
                <a href="{{ faceit.faceit_url }}" target="_blank"
                   class="flex items-center gap-2 bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg transition">
                    <img src="https://cdn-frontend.faceit-cdn.net/web/static/media/faceit-short-white.b43cf8fd.svg" alt="FACEIT" class="h-4"> FACEIT Profile
                </a>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <!-- Teams -->
        {% if teams %}
        <div class="card p-6 mb-6">
            <h2 class="text-2xl font-bold mb-4"><i class="fas fa-users text-purple-400 mr-2"></i> Teams</h2>
            <div class="space-y-3">
                {% for team in teams %}
                <a href="{{ url_for('team_view', team_id=team.id) }}" class="flex items-center gap-3 bg-gray-700 hover:bg-gray-600 rounded-lg p-3 transition">
                    {% if team.logo %}
                        <img src="{{ url_for('uploaded_file', filename=team.logo) }}" alt="{{ team.name }}" class="w-10 h-10 rounded object-cover">
                    {% else %}
                        <div class="w-10 h-10 rounded bg-purple-600 flex items-center justify-center text-white font-bold">{{ team.tag[:2] if team.tag else '?' }}</div>
                    {% endif %}
                    <div>
                        <div class="font-bold">{{ team.name }}</div>
                        <div class="text-xs text-gray-400">{{ team.game or '' }} {% if team.tag %}[{{ team.tag }}]{% endif %}</div>
                    </div>
                </a>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Stats -->
        <div class="card p-6">
            <h2 class="text-2xl font-bold mb-4"><i class="fas fa-chart-line text-purple-400 mr-2"></i> Statistics</h2>

            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="text-center p-4 bg-gray-700 rounded-lg">
                    <div class="text-2xl font-bold text-purple-400">{{ stats.tournaments_played }}</div>
                    <div class="text-xs text-gray-400">Tournaments</div>
                </div>
                <div class="text-center p-4 bg-gray-700 rounded-lg">
                    <div class="text-2xl font-bold text-green-400">{{ stats.tournaments_won }}</div>
                    <div class="text-xs text-gray-400">Won</div>
                </div>
                <div class="text-center p-4 bg-gray-700 rounded-lg">
                    <div class="text-2xl font-bold text-blue-400">{{ stats.matches_played }}</div>
                    <div class="text-xs text-gray-400">Matches</div>
                </div>
                <div class="text-center p-4 bg-gray-700 rounded-lg">
                    <div class="text-2xl font-bold text-pink-400">{{ stats.win_rate }}%</div>
                    <div class="text-xs text-gray-400">Win Rate</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Avatar & Info -->
    <div>
        {% if user.avatar %}
            <div class="card p-6 mb-6">
                {% if user.avatar.startswith('http') %}
                    <img src="{{ user.avatar }}" alt="{{ user.username }}" class="w-full h-auto rounded-lg">
                {% else %}
                    <img src="{{ url_for('uploaded_file', filename=user.avatar) }}" alt="{{ user.username }}" class="w-full h-auto rounded-lg">
                {% endif %}
            </div>
        {% else %}
            <div class="card p-6 mb-6">
                <div class="w-full aspect-square bg-gradient-to-br from-purple-600 to-pink-600 rounded-lg flex items-center justify-center">
                    <i class="fas fa-user text-6xl text-white opacity-50"></i>
                </div>
            </div>
        {% endif %}

        <!-- Activity -->
        <div class="card p-6">
            <h3 class="text-lg font-bold mb-4">Activity</h3>
            <div class="space-y-2 text-sm text-gray-400">
                <div>
                    <div class="text-gray-300 font-semibold mb-1">Member Since</div>
                    <div>{{ user.created_at.strftime('%d %b %Y') }}</div>
                </div>
                <div>
                    <div class="text-gray-300 font-semibold mb-1">Last Login</div>
                    <div>{{ user.last_login.strftime('%d %b %Y, %H:%M') if user.last_login else 'Never' }}</div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
